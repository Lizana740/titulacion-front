"use strict";(self.webpackChunkdicrea=self.webpackChunkdicrea||[]).push([[273],{1273:(et,f,n)=>{n.r(f),n.d(f,{PlanModule:()=>tt});var _=n(6895),m=n(3060),l=n(4006),A=n(5226),g=n.n(A),t=n(4650),Z=n(8856),C=n(3435);let h=(()=>{class e{constructor(o){this.genericServices=o,this.url="/plan/"}guardar(o,a){return this.genericServices.postGeneric(this.url,o,a)}eliminar(o){return this.genericServices.getGeneric(this.url,o)}}return e.\u0275fac=function(o){return new(o||e)(t.LFG(C.M))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var U=n(3238),v=n(3848),b=n(805),u=n(47),T=n(9549),x=n(4385),q=n(4144),N=n(1493);function S(e,i){1&e&&(t.TgZ(0,"button",27),t._UZ(1,"i",28),t._uU(2," Asignar "),t.qZA())}function F(e,i){1&e&&(t.TgZ(0,"tr")(1,"th"),t._uU(2,"ID"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"Tipo"),t.qZA(),t.TgZ(5,"th"),t._uU(6,"Acci\xf3n"),t.qZA()())}function y(e,i){if(1&e&&(t.TgZ(0,"tr")(1,"td",29),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td")(6,"div",3)(7,"div",30)(8,"button",31),t._UZ(9,"i",32),t.qZA()()()()()),2&e){const o=i.$implicit;t.xp6(2),t.hij(" ",o.id_sensor,""),t.xp6(2),t.hij(" ",o.tipo,"")}}function I(e,i){1&e&&(t.TgZ(0,"tr")(1,"td",33),t._uU(2,"No hay sensores registrados en para esta estaci\xf3n"),t.qZA()())}function J(e,i){1&e&&(t.TgZ(0,"tr")(1,"th"),t._uU(2,"ID"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"Tipo "),t.qZA(),t.TgZ(5,"th"),t._uU(6,"Acci\xf3n"),t.qZA()())}function Y(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"tr")(1,"td",29),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td")(6,"div",3)(7,"div",30)(8,"button",34),t.NdJ("click",function(){const c=t.CHM(o).$implicit,s=t.oxw();return t.KtG(s.configurarActuador(c.id_actuador))}),t._UZ(9,"i",32),t.qZA()()()()()}if(2&e){const o=i.$implicit;t.xp6(2),t.hij(" ",o.id_actuador,""),t.xp6(2),t.hij(" ",o.tipo,"")}}function E(e,i){1&e&&(t.TgZ(0,"tr")(1,"td",33),t._uU(2,"No hay actuadores registrados en para esta estaci\xf3n"),t.qZA()())}function O(e,i){if(1&e&&(t.TgZ(0,"mat-option",14),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.Q6J("value",o.id_sensor),t.xp6(1),t.hij(" ",o.tipo," ")}}function j(e,i){if(1&e&&(t.TgZ(0,"mat-option",14),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.Q6J("value",o.label),t.xp6(1),t.hij(" ",o.label," ")}}function L(e,i){if(1&e&&(t.TgZ(0,"form",6)(1,"div",5)(2,"div",3)(3,"h2"),t._uU(4,"Selecione el sensor"),t.qZA(),t.TgZ(5,"div",7)(6,"mat-form-field",10)(7,"mat-label"),t._uU(8,"Sensor"),t.qZA(),t.TgZ(9,"mat-select",35),t.YNc(10,O,2,2,"mat-option",36),t.qZA()()()(),t.TgZ(11,"div",3)(12,"h2"),t._uU(13,"Condici\xf3n"),t.qZA(),t.TgZ(14,"div",7)(15,"mat-form-field",10)(16,"mat-label"),t._uU(17,"Operaci\xf3n"),t.qZA(),t.TgZ(18,"mat-select",37),t.YNc(19,j,2,2,"mat-option",36),t.qZA()()()(),t.TgZ(20,"div",3)(21,"h2"),t._uU(22,"Valor"),t.qZA(),t.TgZ(23,"div",7)(24,"mat-form-field",10),t._UZ(25,"mat-label")(26,"input",38),t.qZA()()(),t.TgZ(27,"div",3)(28,"h2"),t._uU(29,"Tiempo de operaci\xf3n"),t.qZA(),t.TgZ(30,"div",7)(31,"mat-form-field",10)(32,"mat-label"),t._uU(33,"Tiempo"),t.qZA(),t._UZ(34,"input",39),t.qZA()()()()()),2&e){const o=t.oxw();t.Q6J("formGroup",o.formulario),t.xp6(10),t.Q6J("ngForOf",o.estacion.sensores),t.xp6(9),t.Q6J("ngForOf",o.options)}}function P(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"button",40),t.NdJ("click",function(){t.CHM(o);const r=t.oxw();return t.KtG(r.cancel())}),t._UZ(1,"i",24),t._uU(2," Cancelar"),t.qZA(),t.TgZ(3,"button",41),t.NdJ("click",function(){t.CHM(o);const r=t.oxw();return t.KtG(r.guardar())}),t._UZ(4,"i",42),t._uU(5," Guardar"),t.qZA()}}const M=function(){return{width:"60vw",height:"38vw"}},Q=function(){return{"75vw":"50vw"}};let w=(()=>{class e{constructor(o,a,r,c){this.activatedRoute=o,this.estacionServices=a,this._builderFrom=r,this.planServices=c,this.periodo=1e4,this.estacion=[],this.loading=!1,this.actuadores=[],this.display=!1,this.options=[{label:"MAYOR"},{label:"MENOR"}],this.plan=[],this.formulario=this._builderFrom.group({time:["",l.kI.required],valor:["",l.kI.required],op:["",l.kI.required],sensor:["",l.kI.required]}),this.formulariocabecera=this._builderFrom.group({descripcion:["",l.kI.required],periodo:["",l.kI.required]})}ngOnInit(){this.activatedRoute.paramMap.subscribe(o=>{let a=parseInt(o.get("id_estacion"));this.estacionServices.getEstacionId(a).subscribe(r=>{this.estacion=r.data,console.log("ESTACION::",this.estacion)})})}configurarActuador(o){let a=this.estacion.actuadores.filter(r=>r.id_actuador==o)[0];console.log("ACTUADOR::",a),this.display=!0,this.id_actuador=a.id_actuador}guardar(){this.actuadores=this.actuadores.filter(o=>o.id_actuador!=this.id_actuador),this.actuadores.push({id_actuador:this.id_actuador,config:this.formulario.value}),console.log("Actuadores:",this.actuadores),this.id_actuador=0,this.formulario.value.valor="",this.formulario.value.op="",this.formulario.value.time="",this.formulario.value.sensor="",this.display=!1}cancel(){this.id_actuador=0,this.formulario.value.valor="",this.formulario.value.op="",this.formulario.value.time="",this.formulario.value.sensor="",this.display=!1}enviar(){this.formulariocabecera.valid?this.planServices.guardar(this.estacion.id_estacion,{id_estacion:this.estacion.id_estacion,cabecera:this.formulariocabecera.value,actuadores:this.actuadores}).subscribe(a=>{g().fire({icon:"success",title:"Se creo el plan con  \xe9xito!!",showConfirmButton:!1,timer:1500})}):(console.log("El formulario esta incompleto"),g().fire({icon:"error",title:"Datos Incompletos",text:"Debe rellenar los datos de periodo y la descripci\xf3n!"}))}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(m.gz),t.Y36(Z.E),t.Y36(l.qu),t.Y36(h))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-agregar"]],decls:51,vars:13,consts:[[1,"container",2,"height","1000px"],[1,"m-3","mt-3"],[1,"card"],[1,"row"],[1,"col-12","m-3","mt-3"],[1,"col-sm-10"],[3,"formGroup"],[1,"col-sm-12"],["appearance","outline",2,"width","40%"],["matInput","","type","time","placeholder","ej: 01:20","formControlName","periodo"],["appearance","outline",2,"width","100%"],["matInput","","placeholder","Descripci\xf3n del plan","formControlName","descripcion","required",""],["class","btn btn-success",4,"ngIf"],["label","Sensores"],[3,"value"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["label","Actuadores"],[1,"card","p-3"],[1,"col-2"],[1,"btn","btn-success",3,"click"],[1,"pi","pi-save"],[1,"btn","btn-danger"],[1,"pi","pi-times"],["header","Configurar Actuador",3,"visible","breakpoints","draggable","resizable","modal","visibleChange"],["pTemplate","footer"],[1,"btn","btn-success"],[1,"pi","pi-user-plus"],[2,"width","10%"],[1,"col"],[1,"btn","btn-info"],[1,"pi","pi-cog"],["colspan","3"],[1,"btn","btn-info",3,"click"],["formControlName","sensor"],[3,"value",4,"ngFor","ngForOf"],["formControlName","op"],["matInput","","type","number","placeholder","ej: 10, 100","formControlName","valor"],["matInput","","placeholder","ej: 100s, 10m","formControlName","time","type","time"],[1,"btn","btn-danger",3,"click"],[1,"btn","btn-primary",3,"click"],[1,"pi","pi-check"]],template:function(o,a){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"form",6)(7,"div",3)(8,"h2"),t._uU(9,"Selecione el periodo de registro las mediciones"),t.qZA(),t.TgZ(10,"div",7)(11,"mat-form-field",8)(12,"mat-label"),t._uU(13,"Rango"),t.qZA(),t._UZ(14,"input",9),t.qZA()()(),t.TgZ(15,"div",3)(16,"h2"),t._uU(17,"Ingrese una breve descripci\xf3n"),t.qZA(),t.TgZ(18,"div",7)(19,"mat-form-field",10)(20,"mat-label"),t._uU(21,"Descripci\xf3n"),t.qZA(),t._UZ(22,"textarea",11),t.qZA()()()()(),t.YNc(23,S,3,0,"button",12),t.qZA()()()(),t.TgZ(24,"div",1)(25,"div",2)(26,"mat-tab-group")(27,"mat-tab",13)(28,"p-table",14),t.YNc(29,F,7,0,"ng-template",15),t.YNc(30,y,10,2,"ng-template",16),t.YNc(31,I,3,0,"ng-template",17),t.qZA()(),t.TgZ(32,"mat-tab",18)(33,"p-table",14),t.YNc(34,J,7,0,"ng-template",15),t.YNc(35,Y,10,2,"ng-template",16),t.YNc(36,E,3,0,"ng-template",17),t.qZA()()()()(),t.TgZ(37,"div",1)(38,"div",19)(39,"div",3)(40,"div",20)(41,"button",21),t.NdJ("click",function(){return a.enviar()}),t._UZ(42,"i",22),t._uU(43," Guardar"),t.qZA()(),t.TgZ(44,"div",20)(45,"button",23),t._UZ(46,"i",24),t._uU(47," Cancelar"),t.qZA()()()()(),t.TgZ(48,"p-dialog",25),t.NdJ("visibleChange",function(c){return a.display=c}),t.YNc(49,L,35,3,"ng-template",16),t.YNc(50,P,6,0,"ng-template",26),t.qZA()()),2&o&&(t.xp6(6),t.Q6J("formGroup",a.formulariocabecera),t.xp6(17),t.Q6J("ngIf",a.loading),t.xp6(5),t.Q6J("value",a.estacion.sensores),t.xp6(5),t.Q6J("value",a.estacion.actuadores),t.xp6(15),t.Akn(t.DdM(11,M)),t.Q6J("visible",a.display)("breakpoints",t.DdM(12,Q))("draggable",!1)("resizable",!1)("modal",!0))},dependencies:[_.sg,_.O5,U.ey,v.SP,v.uX,b.jx,u.iA,T.KE,T.hX,x.gD,q.Nt,N.V,l._Y,l.Fj,l.wV,l.JJ,l.JL,l.Q7,l.sg,l.u]}),e})();var G=n(9421),k=n(8841),D=n(3608);function R(e,i){1&e&&(t.TgZ(0,"tr"),t._UZ(1,"th",7),t.TgZ(2,"th",8),t._uU(3,"Nombre Estaci\xf3n"),t._UZ(4,"p-sortIcon",9),t.qZA(),t.TgZ(5,"th",10),t._uU(6,"Ubicaci\xf3n"),t._UZ(7,"p-sortIcon",11),t.qZA(),t.TgZ(8,"th",12),t._uU(9,"Acciones"),t._UZ(10,"p-sortIcon"),t.qZA()())}function B(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"tr")(1,"td")(2,"button",13),t._UZ(3,"i"),t.qZA()(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td")(9,"div",14)(10,"div",15)(11,"button",16),t.NdJ("click",function(){const c=t.CHM(o).$implicit,s=t.oxw();return t.KtG(s.crearPlan(c.id_estacion))}),t._UZ(12,"i",17),t.qZA()()()()()}if(2&e){const o=i.$implicit,a=i.expanded;t.xp6(2),t.Q6J("pRowToggler",o),t.xp6(1),t.Tol(a?"pi pi-chevron-down":"pi pi-chevron-right"),t.xp6(2),t.Oqu(o.nombre),t.xp6(2),t.Oqu(o.ubicacion)}}function $(e,i){1&e&&(t.TgZ(0,"tr")(1,"th",22),t._uU(2,"ID"),t._UZ(3,"p-sortIcon",23),t.qZA(),t.TgZ(4,"th",24),t._uU(5," Descripci\xf3n"),t._UZ(6,"p-sortIcon",25),t.qZA(),t.TgZ(7,"th",26),t._uU(8,"Fecha"),t._UZ(9,"p-sortIcon",27),t.qZA(),t.TgZ(10,"th"),t._uU(11,"Acciones"),t.qZA()())}function z(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td",14)(8,"div",15)(9,"button",28),t.NdJ("click",function(){const c=t.CHM(o).$implicit,s=t.oxw(2);return t.KtG(s.eliminar(c.id_plan))}),t._UZ(10,"i",29),t.qZA()(),t.TgZ(11,"div",15)(12,"button",30),t._UZ(13,"i",31),t.qZA()()()()}if(2&e){const o=i.$implicit;t.xp6(2),t.Oqu(o.id_plan),t.xp6(2),t.Oqu(o.configuracion.cabecera.descripcion),t.xp6(2),t.Oqu(o.descripcion)}}function K(e,i){1&e&&(t.TgZ(0,"tr")(1,"td",32),t._uU(2,"No hay planes creados para esta estaci\xf3n"),t.qZA()())}function H(e,i){if(1&e&&(t.TgZ(0,"tr")(1,"td",18)(2,"div",19)(3,"p-table",20),t.YNc(4,$,12,0,"ng-template",4),t.YNc(5,z,14,3,"ng-template",5),t.YNc(6,K,3,0,"ng-template",21),t.qZA()()()()),2&e){const o=i.$implicit;t.xp6(3),t.Q6J("value",o.planes)}}const X=[{path:"listar",component:(()=>{class e{constructor(o,a,r,c){this.estacionServices=o,this.autentificacionServices=a,this.router=r,this.planServices=c,this.estaciones=[]}ngOnInit(){this.getEstaciones()}getEstaciones(){let a=this.autentificacionServices.infoUser().trabajador.id_trabajador,r=parseInt(localStorage.getItem("id_rol"));r!=G.TA?this.estacionServices.getEstacionesPorRol({id_trabajador:a,id_rol:r}).subscribe(c=>{for(var s of(this.estaciones=c.data,c.data)){let d=[];for(var p of s.planes)console.log("t",JSON.parse(p.configuracion)),d.push({id_plan:p.id_plan,configuracion:JSON.parse(p.configuracion),id_estacion:p.id_estacion});this.estaciones.push({actuadores:s.actuadores,sensores:s.sensores,ubicacion:s.ubicacion,id_estacion:s.id_estacion,nombre:s.nombre,planes:d})}}):this.estacionServices.getEstacion().subscribe(c=>{for(var s of(console.log("PLANES",c.data),c.data)){let d=[];for(var p of s.planes)console.log("t",JSON.parse(p.configuracion)),d.push({id_plan:p.id_plan,configuracion:JSON.parse(p.configuracion),id_estacion:p.id_estacion});this.estaciones.push({actuadores:s.actuadores,sensores:s.sensores,ubicacion:s.ubicacion,id_estacion:s.id_estacion,nombre:s.nombre,planes:d})}})}crearPlan(o){this.router.navigate([`app/plan/agregar/${o}`])}eliminar(o){g().fire({title:"\xbfEstas seguro de eliminar?",text:"Los cambios seran permanentes",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Si, eliminar"}).then(a=>{a.isConfirmed&&this.planServices.eliminar(o).subscribe(r=>{this.ngOnInit()},r=>{g().fire({icon:"error",title:"Oops...",text:"No se ha podido eliminar el plan!"})})})}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(Z.E),t.Y36(k.Q),t.Y36(m.F0),t.Y36(h))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-lista"]],decls:9,vars:1,consts:[[1,"m-3","mt-3"],[1,"card"],[1,"card-header",2,"color","grey"],["dataKey","nombre",3,"value"],["pTemplate","header"],["pTemplate","body"],["pTemplate","rowexpansion"],[2,"width","5rem"],["pSortableColumn","nombre"],["field","nombre"],["pSortableColumn","ubicacion"],["field","ubicacion"],["pSortableColumn",""],["pTooltip","Expandir","tooltipPosition","top",1,"btn",3,"pRowToggler"],[1,"row"],[1,"col"],["pTooltip","Agregar","tooltipPosition","top",1,"btn","btn-success",3,"click"],[1,"pi","pi-plus-circle"],["colspan","5"],[1,"p-3"],["dataKey","id_sensor",3,"value"],["pTemplate","emptymessage"],["pSortableColumn","modelo"],["field","customer"],["pSortableColumn","tipo"],["field","date"],["pSortableColumn","descripcion"],["field","amount"],["pTooltip","Eliminar","tooltipPosition","top",1,"btn","btn-danger",3,"click"],[1,"pi","pi-trash"],[1,"btn","btn-warning","text-white"],["pTooltip","Editar","tooltipPosition","top",1,"pi","pi-pencil"],["colspan","6"]],template:function(o,a){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),t._uU(4," Lista de Estaciones"),t.qZA()(),t.TgZ(5,"p-table",3),t.YNc(6,R,11,0,"ng-template",4),t.YNc(7,B,13,5,"ng-template",5),t.YNc(8,H,7,1,"ng-template",6),t.qZA()()()),2&o&&(t.xp6(5),t.Q6J("value",a.estaciones))},dependencies:[D.u,b.jx,u.iA,u.lQ,u.jB,u.fz]}),e})(),data:{breadcrumb:{label:"Lista"}}},{path:"agregar/:id_estacion",component:w,data:{breadcrumb:{label:"A\xf1adir plan"}}}];let V=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[m.Bz.forChild(X),m.Bz]}),e})();var W=n(5782);let tt=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[_.ez,V,W.m]}),e})()}}]);